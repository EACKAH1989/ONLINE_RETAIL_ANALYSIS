---
title: "ANALYSIS OF ONLINE RETAIL TRANSACTIONS"
name:"EMMANUEL ATTAH ACKAH"
output: pdf_document
date: "2026-01-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(dplyr)
library(ggplot2)
library(tidyverse)
#install.packages("readxl")
library(readxl)
```


```{r}
retail <- read_xlsx("//Users/ataka/Desktop/ONLINE_RETAIL_ANALYSIS/DATA/online_retail_II.xlsx")
```

```{r}
head(retail)
str(retail)
summary(retail)
```

```{r}
colnames(retail)
```
```{r}
library(janitor)

retail <- retail %>%
  clean_names()

```
```{r}
#Used this to determine the total number of individual customers served 
retail %>%
  summarise(
    total_customers = n_distinct(customer_id, na.rm = TRUE)
    )
#Used this step to determine the total number of countries the transactions were received from
retail %>%
  summarise(
    unique_countries = n_distinct(country, na.rm = TRUE)
    )
```
```{r}
#Used this step to determine the total revenue generated by all the transactions recorded
retail %>%
  summarise(
    total_revenue = sum(quantity * price, na.rm=TRUE)
  )
```
```{r}
#Wanted to determine how many orders were placed 
retail %>%
  summarise(total_orders = n_distinct(invoice))
```
```{r}
#Total revenue generated per individual country
retail %>%
  group_by(country) %>%
  summarise(revenue = sum(quantity * price, na.rm = TRUE)) %>%
  arrange(desc(revenue))
```


```{r}
# Remove cancelled transactions, missing customers, and invalid values
retail_clean <- retail %>%
  filter(
    !is.na(customer_id),
    quantity > 0,
    price > 0,
    !grepl("^C", invoice)
  )

# Create revenue variable
retail_clean <- retail_clean %>%
  mutate(
    revenue = quantity * price
  )
```


```{r}
retail_clean <- retail_clean %>%
  mutate(
    invoice_date = as.POSIXct(invoice_date),
    year = lubridate::year(invoice_date),
    month = lubridate::month(invoice_date, label = TRUE),
    year_month = format(invoice_date, "%Y-%m")
  )
```

```{r}
monthly_revenue <- retail_clean %>%
  group_by(year_month) %>%
  summarise(
    total_revenue = sum(revenue),
    total_orders = n_distinct(invoice)
  ) %>%
  arrange(year_month)

monthly_revenue
```

```{r}
ggplot(monthly_revenue, aes(x = year_month, y = total_revenue)) +
  geom_line(group = 1, color = "steelblue") +
  geom_point(color = "steelblue") +
  labs(
    title = "Monthly Revenue Trend",
    x = "Year-Month",
    y = "Total Revenue"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
```{r}
top_products <- retail_clean %>%
  group_by(description) %>%
  summarise(
    total_revenue = sum(revenue),
    total_quantity = sum(quantity)
  ) %>%
  arrange(desc(total_revenue)) %>%
  slice_head(n = 10)

top_products
```
```{r}
ggplot(top_products, aes(x = reorder(description, total_revenue), y = total_revenue)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Top 10 Products by Revenue",
    x = "Product",
    y = "Total Revenue"
  ) +
  theme_minimal()
```
```{r}
customer_summary <- retail_clean %>%
  group_by(customer_id) %>%
  summarise(
    total_spent = sum(revenue),
    number_of_orders = n_distinct(invoice),
    avg_order_value = total_spent / number_of_orders
  )

summary(customer_summary)
```
```{r}
customer_summary <- customer_summary %>%
  mutate(
    customer_segment = case_when(
      total_spent >= quantile(total_spent, 0.9) ~ "Top 10% Spenders",
      total_spent >= quantile(total_spent, 0.5) ~ "Mid Spenders",
      TRUE ~ "Low Spenders"
    )
  )

ggplot(customer_summary, aes(x = customer_segment, y = total_spent, fill = customer_segment)) +
  geom_boxplot() +
  labs(title = "Customer Segments by Total Revenue", x = "Segment", y = "Total Spent") +
  theme_minimal()
```
```{r}
#Determine which countries contribute the most revenue over time
monthly_country_revenue <- retail_clean %>%
  group_by(year_month, country) %>%
  summarise(total_revenue = sum(revenue)) %>%
  arrange(year_month)

ggplot(monthly_country_revenue, aes(x = year_month, y = total_revenue, color = country, group = country)) +
  geom_line() +
  labs(title = "Monthly Revenue by Country", x = "Year-Month", y = "Revenue") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
#Determine top revenue products
top_products_plot <- retail_clean %>%
  group_by(description) %>%
  summarise(total_revenue = sum(revenue), total_quantity = sum(quantity)) %>%
  arrange(desc(total_revenue)) %>%
  slice_head(n = 20)

ggplot(top_products_plot, aes(x = reorder(description, total_quantity), y = total_quantity, fill = total_revenue)) +
  geom_col() +
  coord_flip() +
  scale_fill_gradient(low = "lightblue", high = "steelblue") +
  labs(title = "Top 20 Products by Quantity and Revenue", x = "Product", y = "Total Quantity Sold") +
  theme_minimal()
```


