---
title: "ANALYSIS OF ONLINE RETAIL TRANSACTIONS"
author: "Emmanuel Attah Ackah"
date: "2026-01-07"
output: 
  html_document:
    theme: flatly
    toc: true
    toc_float: true
    code_folding: show
---
# Analysis of Online Retail Transactions

**Author:** Emmanuel Attah Ackah  
**Tools:** R, dplyr, ggplot2, tidyverse, lubridate  
**Output:** PDF Report  

## Project Overview
This project analyzes online retail transaction data to understand revenue trends, customer purchasing behavior, product performance, and geographic sales distribution. The goal is to generate actionable insights that support data-driven business and operational decisions.

## Business Questions
- How does revenue change over time?
- Which products generate the highest revenue?
- Are there identifiable customer segments based on spending behavior?
- Which countries contribute the most to overall revenue?
- Are there seasonal patterns in purchasing activity?

## Data Cleaning & Preparation
- Removed canceled transactions
- Excluded records with missing customer IDs
- Filtered out invalid quantities and prices
- Engineered revenue and time-based features (year, month)

## Key Analyses
- Monthly revenue and order trends
- Top products by revenue and quantity sold
- Customer segmentation based on spending behavior
- Country-level revenue contributions over time

## Key Insights
- Revenue exhibits strong seasonality, with noticeable peaks during specific months.
- A small group of high-value customers contributes a disproportionate share of total revenue.
- A limited number of products drive most sales, highlighting opportunities for inventory optimization.
- Revenue is concentrated in a few countries, suggesting geographic growth opportunities.

## Recommendations
- Prioritize retention strategies for high-value customers.
- Optimize inventory for top-performing products ahead of peak seasons.
- Expand targeted marketing in high-revenue countries.
- Develop loyalty programs to increase repeat purchases among mid-tier customers.

## Limitations & Next Steps
- Lack of customer demographic data limits deeper behavioral analysis.
- Future work could include cohort analysis and customer lifetime value modeling.
- Predictive models could be developed for revenue forecasting and churn prediction.

## Files
- `analysis.Rmd` – Full analysis workflow
- `analysis.pdf` – Final report output
- `data/` – Raw dataset
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(dplyr)
library(ggplot2)
library(tidyverse)
#install.packages("readxl")
library(readxl)
library(janitor)
```


```{r}
## Data Import and Overview
retail <- read_xlsx("//Users/ataka/Desktop/ONLINE_RETAIL_ANALYSIS/DATA/online_retail_II.xlsx")
head(retail)
str(retail)
summary(retail)
colnames(retail)
```

```{r}
## Data Cleaning and Feature Engineering
retail <- retail %>%
  clean_names()
#Used this to determine the total number of individual customers served 
retail %>%
  summarise(
    total_customers = n_distinct(customer_id, na.rm = TRUE)
    )
#Used this step to determine the total number of countries the transactions were received from
retail %>%
  summarise(
    unique_countries = n_distinct(country, na.rm = TRUE)
    )
```
```{r}
## Revenue and Order Trends
#Used this step to determine the total revenue generated by all the transactions recorded
retail %>%
  summarise(
    total_revenue = sum(quantity * price, na.rm=TRUE)
  )
#Wanted to determine how many orders were placed 
retail %>%
  summarise(total_orders = n_distinct(invoice))

#Total revenue generated per individual country
retail %>%
  group_by(country) %>%
  summarise(revenue = sum(quantity * price, na.rm = TRUE)) %>%
  arrange(desc(revenue))
```



```{r}
## Product Performance Analysis
# Remove cancelled transactions, missing customers, and invalid values
retail_clean <- retail %>%
  filter(
    !is.na(customer_id),
    quantity > 0,
    price > 0,
    !grepl("^C", invoice)
  )

# Create revenue variable
retail_clean <- retail_clean %>%
  mutate(
    revenue = quantity * price
  )

retail_clean <- retail_clean %>%
  mutate(
    invoice_date = as.POSIXct(invoice_date),
    year = lubridate::year(invoice_date),
    month = lubridate::month(invoice_date, label = TRUE),
    year_month = format(invoice_date, "%Y-%m")
  )

monthly_revenue <- retail_clean %>%
  group_by(year_month) %>%
  summarise(
    total_revenue = sum(revenue),
    total_orders = n_distinct(invoice)
  ) %>%
  arrange(year_month)

monthly_revenue
```


```{r}
ggplot(monthly_revenue, aes(x = year_month, y = total_revenue)) +
  geom_line(group = 1, color = "steelblue") +
  geom_point(color = "steelblue") +
  labs(
    title = "Monthly Revenue Trend",
    x = "Year-Month",
    y = "Total Revenue"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```
```{r}
top_products <- retail_clean %>%
  group_by(description) %>%
  summarise(
    total_revenue = sum(revenue),
    total_quantity = sum(quantity)
  ) %>%
  arrange(desc(total_revenue)) %>%
  slice_head(n = 10)

top_products
```
```{r}
ggplot(top_products, aes(x = reorder(description, total_revenue), y = total_revenue)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Top 10 Products by Revenue",
    x = "Product",
    y = "Total Revenue"
  ) +
  theme_minimal()
```
```{r}
## Customer Segmentation
customer_summary <- retail_clean %>%
  group_by(customer_id) %>%
  summarise(
    total_spent = sum(revenue),
    number_of_orders = n_distinct(invoice),
    avg_order_value = total_spent / number_of_orders
  )

summary(customer_summary)

customer_summary <- customer_summary %>%
  mutate(
    customer_segment = case_when(
      total_spent >= quantile(total_spent, 0.9) ~ "Top 10% Spenders",
      total_spent >= quantile(total_spent, 0.5) ~ "Mid Spenders",
      TRUE ~ "Low Spenders"
    )
  )

ggplot(customer_summary, aes(x = customer_segment, y = total_spent, fill = customer_segment)) +
  geom_boxplot() +
  labs(title = "Customer Segments by Total Revenue", x = "Segment", y = "Total Spent") +
  theme_minimal()
```

```{r}
## Geographic Revenue Patterns
#Determine which countries contribute the most revenue over time
monthly_country_revenue <- retail_clean %>%
  group_by(year_month, country) %>%
  summarise(total_revenue = sum(revenue)) %>%
  arrange(year_month) %>%
  slice_head(n=20)

ggplot(monthly_country_revenue, aes(x = year_month, y = total_revenue, color = country, group = country)) +
  geom_line() +
  labs(title = "Monthly Revenue by Country", x = "Year-Month", y = "Revenue") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
#Determine top revenue products
top_products_plot <- retail_clean %>%
  group_by(description) %>%
  summarise(total_revenue = sum(revenue), total_quantity = sum(quantity)) %>%
  arrange(desc(total_revenue)) %>%
  slice_head(n = 20)

ggplot(top_products_plot, aes(x = reorder(description, total_quantity), y = total_quantity, fill = total_revenue)) +
  geom_col() +
  coord_flip() +
  scale_fill_gradient(low = "lightblue", high = "steelblue") +
  labs(title = "Top 20 Products by Quantity and Revenue", x = "Product", y = "Total Quantity Sold") +
  theme_minimal()
```
```{r}
# Quick tip for a map:
library(rnaturalearth)
#install.packages("highcharter")
library(highcharter)

# Aggregate revenue by country
world_data <- retail_clean %>% 
  group_by(country) %>% 
  summarise(value = sum(revenue))

#Geographical representation of revenue by country
hcmap("custom/world-robinson-lowres", data = world_data, value = "value",
      joinBy = c("name", "country"), name = "Total Revenue")
```

```{r}
#Prepare RFM Data
# Used the max date in the dataset as the 'today' for the analysis
analysis_date <- max(retail_clean$invoice_date) + lubridate::days(1)

rfm_data <- retail_clean %>%
  group_by(customer_id) %>%
  summarise(
    recency = as.numeric(difftime(analysis_date, max(invoice_date), units = "days")),
    frequency = n_distinct(invoice),
    monetary = sum(revenue)
  )

#Assign Scores (1-5) using Quintiles
# 5 is the best (most recent, most frequent, highest spend)
rfm_data <- rfm_data %>%
  mutate(
    r_score = ntile(desc(recency), 5), # Lower recency days = Higher score
    f_score = ntile(frequency, 5),     # Higher frequency = Higher score
    m_score = ntile(monetary, 5)       # Higher monetary = Higher score
  ) %>%
  mutate(rfm_group = paste0(r_score, f_score, m_score))
```


```{r}
#Define Customer Segments
rfm_data <- rfm_data %>%
  mutate(customer_segment = case_when(
    r_score >= 4 & f_score >= 4 & m_score >= 4 ~ "Champions",
    r_score >= 3 & f_score >= 3 ~ "Loyal Customers",
    r_score >= 4 & f_score <= 2 ~ "Recent Customers",
    r_score <= 2 & m_score >= 4 ~ "At Risk (Big Spenders)",
    r_score <= 1 ~ "Lost",
    TRUE ~ "Others"
  ))

#Visualize the Segments with Color
ggplot(rfm_data, aes(x = reorder(customer_segment, monetary, FUN = median), y = monetary, fill = customer_segment)) +
  geom_boxplot() +
  scale_y_log10() + # Using log scale because monetary values can vary wildly
  scale_fill_viridis_d(option = "mako", guide = "none") +
  coord_flip() +
  theme_minimal() +
  labs(title = "RFM Customer Segments by Monetary Value",
       subtitle = "Champions represent the highest lifetime value",
       x = "Segment", y = "Total Spend (Log Scale)")
```



